<script>
    jQuery(document).ready(function () {
        jQuery('.datetimepicker').datepicker({
            timepicker: true,
            language: 'en',
            range: true,
            multipleDates: true,
            multipleDatesSeparator: " - "
        });
        jQuery("#add-event").submit(function () {
            alert("Submitted");
            var values = {};
            $.each($('#add-event').serializeArray(), function (i, field) {
                values[field.name] = field.value;
            });
            console.log(
                values
            );
        });
    });

    (function () {
        'use strict';

        var events = JSON.parse('{{ events | safe |escapejs }}');
        var dates = JSON.parse('{{ events_date | safe |escapejs }}');
        var descrip = JSON.parse('{{ events_description | safe | escapejs}}');
        var end_time = JSON.parse('{{ events_endtime | safe | escapejs }}');
        var data = [];
        var i = 0;
        for (i = 0; i < events.length; i++) {
            data.push(
                {
                    title: events[i],
                    description: descrip[i],
                    start: dates[i],
                    end: end_time[i],
                    className: 'fc-bg-primary',
                    icon: "suitcase"
                },
            );
        }

        // ------------------------------------------------------- //
        // Calendar
        // ------------------------------------------------------ //




        jQuery(function () {
            // page is ready
            jQuery('#calendar').fullCalendar({

                height: 550,
                themeSystem: 'bootstrap4',
                // emphasizes business hours
                businessHours: false,
                defaultView: 'month',
                // event dragging & resizing
                editable: false,



                // header
                header: {
                    left: 'title',
                    center: 'month,agendaWeek,agendaDay,list',
                    right: 'today prev,next '
                },
                events: data,

                eventRender: function (event, element) {
                    if (event.icon) {
                        element.find(".fc-title").prepend("<i class='fa fa-" + event.icon + "fc-bg-lightgreen'></i>");
                    }
                },
                dayClick: function () {
                    jQuery('.show-form').click();
                },
                eventClick: function (event, jsEvent, view) {
                    jQuery('.event-icon').html("<i class='fa fa-" + event.icon + "'></i>");
                    jQuery('.event-title').html(event.title);
                    jQuery('.event-body').html(event.description);
                    jQuery('.eventUrl').attr('href', event.url);
                    jQuery('#modal-view-event').modal();
                },
            });



            var month = $("#calendar").fullCalendar('getDate').month() + 1;
            var year = $("#calendar").fullCalendar('getDate').year();
            console.log(year)
            var curr_month =  month;
            var curr_year =  year;
            $('.fc-prev-button').click(function () {
                month -= 1;
                if (month == 0) {
                    month = 12;
                    year -= 1;
                }

            });
            $('.fc-next-button').click(function () {
                month += 1;
                if (month == 13) {
                    month = 1;
                    year += 1;
                }

            });
            $('.fc-today-button').on('click', function () {
                month = curr_month;
                year = curr_year;

                $("#approvalmonth").val(curr_month);
                console.log(ajaxcall());
            });

            function select(){
                $("#approvalmonth").val(curr_month);
                ajaxcall();
            }

            $(window).on('load', select());

            var obj = { 'report_array': month };

            $('.fc-prev-button').on('click', function () {
                $("#approvalmonth").val(month);
                console.log(ajaxcall());
            });
            $('.fc-next-button').on('click', function () {
                $("#approvalmonth").val(month);
                console.log(ajaxcall());
            });


            // AJAX 
            function ajaxcall() {
                $.ajax({
                    url: '{% url "HR_tasks:json_data" user.id  %}',
                    data: {
                    'month': month, 'year': curr_year,
                    },
                    dataType: 'json',
                    success: function (data) {
                    if (data.week_1==true) {
                        document.getElementById('check1').style.display ='inline';
                        document.getElementById('noIdea1').style.display ='none';
                        document.getElementById('cross1').style.display ='none';
                    }
                    else if(data.week_1==false){
                        document.getElementById('cross1').style.display ='inline';
                        document.getElementById('check1').style.display ='none';
                        document.getElementById('noIdea1').style.display ='none';
                        }
                    else if(data.week_1=="no"){
                        document.getElementById('check1').style.display ='none';
                        document.getElementById('noIdea1').style.display ='inline';
                        document.getElementById('cross1').style.display ='none';
                    }
                    if(data.week_2==true){
                        document.getElementById('check2').style.display ='inline';
                        document.getElementById('noIdea2').style.display ='none';
                        document.getElementById('cross2').style.display ='none';
                    }
                    else if(data.week_2==false){
                        document.getElementById('cross2').style.display ='inline';
                        document.getElementById('check2').style.display ='none';
                        document.getElementById('noIdea2').style.display ='none';
                        }
                        else{
                        document.getElementById('check2').style.display ='none';
                        document.getElementById('noIdea2').style.display ='inline';
                        document.getElementById('cross2').style.display ='none';
                    }
                    if(data.week_3==true){
                        document.getElementById('check3').style.display ='inline';
                        document.getElementById('noIdea3').style.display ='none';
                        document.getElementById('cross3').style.display ='none';
                    }
                    else if(data.week_3==false){
                        document.getElementById('cross3').style.display ='inline';
                        document.getElementById('check3').style.display ='none';
                        document.getElementById('noIdea3').style.display ='none';
                        }
                        else{
                        document.getElementById('check3').style.display ='none';
                        document.getElementById('noIdea3').style.display ='inline';
                        document.getElementById('cross3').style.display ='none';
                    }
                    if(data.week_4==true){
                        document.getElementById('check4').style.display ='inline';
                        document.getElementById('noIdea4').style.display ='none';
                        document.getElementById('cross4').style.display ='none';
                    }
                    else if(data.week_4==false){
                        document.getElementById('cross4').style.display ='inline';
                        document.getElementById('check4').style.display ='none';
                        document.getElementById('noIdea4').style.display ='none';
                        }
                        else{
                        document.getElementById('check4').style.display ='none';
                        document.getElementById('noIdea4').style.display ='inline';
                        document.getElementById('cross4').style.display ='none';
                    }
                    if(data.comment[0]){
                        document.getElementById('comments').innerHTML='';
                        document.getElementById('comments').append(data.comment[0].comment);
                        console.log(data.comment[0].comment)
                        if(data.comment[0].comment==undefined){
                            document.getElementById('comments').innerHTML='<h2><b>No comments recived by this employee in current month yet.</b> </h2><br><p> Approve the timesheet to see comments...</p>';

                        }
                    }
                        
                    }
                });
            }

            $('.fc-prev-button').on('click', function () {

            });

            // $.ajax({
            //     type: 'POST',
            //     url: '{% url "HR_tasks:my_event" %}',
            //     contentType: 'application/json; charset=utf-8', //EDITED
            //     data: {
            //         'month': month,
            //         // 'X-CSRFToken': '{% csrf_token %}',
            //     },
            //     success: function(data) {
            //         $('body').html(data); //EDITED
            //     },
            //     error: function(rs, e) {     
            //         alert(rs.responseText);               
            //     }
            // });
            return false; 
            //   var month = date.month()+1;


        });

    })(jQuery);


</script>